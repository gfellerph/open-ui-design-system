---
import fs from "node:fs/promises";
import path from "node:path";

const { style, markup } = Astro.props;

let css = "";
let html = "";

if (style) {
  const stylePath = path.resolve("src/content/components", style);
  try {
    css = await fs.readFile(stylePath, "utf8");
  } catch (e) {
    css = "/* Could not load stylesheet: " + stylePath + " */";
  }
}

if (markup) {
  const markupPath = path.resolve("src/content/components", markup);
  try {
    html = await fs.readFile(markupPath, "utf8");
  } catch (e) {
    html = "<!-- Could not load markup: " + markupPath + " -->";
  }
}
---

<oui-preview>
  <template shadowrootmode="open">
    <style>
      /* Disable inheritance from outside styles */
      :host {
        all: initial;
      }
    </style>
    {css && <style set:html={css} />}
    {html && <Fragment set:html={html} />}
    <slot />
  </template>
</oui-preview>

<style>
  oui-preview {
    display: block;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 1.5rem;
  }
</style>
